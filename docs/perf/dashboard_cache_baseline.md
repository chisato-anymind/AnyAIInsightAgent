# Dashboard Cache Baseline — 2025-10-13

本ドキュメントは、ダッシュボードキャッシュ導入前後の性能指標を追跡するためのメモです。2025-10-13 時点ではキャッシュ機構を実装した直後であり、実データによる計測は 2025-10-17 以降に実施します。

## 1. 目的
- `/dashboard/persona/runs/{job_id}/query` エンドポイントのレスポンス時間短縮
- 同一ジョブへの繰り返し問い合わせによるPolars/LLMコスト削減
- フィルタ組み合わせごとの応答時間を数値化し、キャッシュ効果を可視化

## 2. 計測方法
| 項目 | 内容 |
|------|------|
| データセット | `runs/<job_id>/persona_responses.json`（~N×M 組み合わせ） |
| ツール | `scripts/test_dashboard_cache.py`（本リポジトリ） |
| 指標 | p50 / p95 レイテンシ、キャッシュヒット率、JSONレスポンスサイズ |
| 回数 | フィルタ未指定＋代表的フィルタ3種を各5回連続実行 |

## 3. TODO（2025-10-17 まで）
- [ ] ベースライン（キャッシュ無効化）でのレスポンス時間測定
- [ ] キャッシュ有効化後の再測定および比較
- [ ] BigQuery or CSV 形式でログ保存し、ダッシュボードに可視化

## 4. 備考
- キャッシュは `runs/<job_id>/cache/` 以下に Parquet/JSON として保存される。
- キャッシュの TTL は 24 時間。ソースデータ更新（レスポンス追記/SSR再計算）で自動無効化される。
- 測定時は `CACHE_TTL_SECONDS` を短縮（例: 60 秒）することで挙動を確認予定。
